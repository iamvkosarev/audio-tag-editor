// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package templates

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

func Index() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<!doctype html><html lang=\"en\"><head><meta charset=\"UTF-8\"><meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"><title>üíø Audio Tag Editor</title>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = Colors().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "<style>\n\n\t\t\t\t* {\n\t\t\t\t\ttransition: background-color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;\n\t\t\t\t}\n\n\t\t\t\tbody, h1, .container, .modal-content, .modal-header h3, .form-group label, .form-group input, .empty-state, .loading {\n\t\t\t\t\ttransition: background-color 0.5s ease, color 0.5s ease, border-color 0.5s ease, box-shadow 0.5s ease;\n\t\t\t\t}\n\n\t\t\t\t.files-table td, .files-table th {\n\t\t\t\t\ttransition: background-color 0.5s ease, border-color 0.5s ease, color 0s;\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t}\n\n\t\t\t\tbody {\n\t\t\t\t\tfont-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n\t\t\t\t\tmax-width: 1200px;\n\t\t\t\t\tmargin: 0 auto;\n\t\t\t\t\tpadding: 2rem;\n\t\t\t\t\tbackground-color: var(--bg-primary);\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t}\n\t\t\t\t.container {\n\t\t\t\t\tbackground: var(--bg-secondary);\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\tpadding: 2rem;\n\t\t\t\t\tbox-shadow: 0 2px 4px var(--shadow);\n\t\t\t\t}\n\t\t\t\th1 {\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t\tmargin-top: 0;\n\t\t\t\t}\n\t\t\t\t.theme-toggle {\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 1rem;\n\t\t\t\t\tright: 1rem;\n\t\t\t\t\tbackground-color: var(--bg-tertiary);\n\t\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\twidth: 48px;\n\t\t\t\t\theight: 48px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tfont-size: 1.5rem;\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\tbox-shadow: 0 2px 8px var(--shadow);\n\t\t\t\t}\n\t\t\t\t.theme-toggle:hover {\n\t\t\t\t\tbackground-color: var(--hover-bg);\n\t\t\t\t\ttransform: scale(1.1);\n\t\t\t\t}\n\t\t\t\t.theme-toggle:focus {\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\t.upload-section {\n\t\t\t\t\tmargin: 2rem 0 1rem 0;\n\t\t\t\t}\n\t\t\t\t.actions-section {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t\tmargin: 1rem 0;\n\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tbackground-color: var(--bg-secondary);\n\t\t\t\t\tpadding: 1rem 0;\n\t\t\t\t\tz-index: 100;\n\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\tmargin-bottom: 0;\n\t\t\t\t}\n\t\t\t\t.file-input-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t\t.file-input {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\topacity: 0;\n\t\t\t\t\twidth: 0;\n\t\t\t\t\theight: 0;\n\t\t\t\t}\n\t\t\t\t.upload-btn, .action-btn {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t\tpadding: 0.75rem 1.5rem;\n\t\t\t\t\tborder: 2px solid var(--primary-blue);\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-size: 1rem;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t}\n\t\t\t\t.upload-btn:hover, .action-btn:hover {\n\t\t\t\t\tbackground-color: var(--primary-blue);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\ttransform: translateY(-1px);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);\n\t\t\t\t}\n\t\t\t\t.upload-btn:focus, .action-btn:focus {\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\t.upload-btn:active, .action-btn:active {\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t\t.action-btn:disabled {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder-color: var(--disabled-gray);\n\t\t\t\t\tcolor: var(--btn-text-inactive);\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t}\n\t\t\t\t.action-btn:disabled:hover {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\ttransform: none;\n\t\t\t\t\tbox-shadow: none;\n\t\t\t\t}\n\t\t\t\t.action-btn.active {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder-color: var(--success-green);\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t}\n\t\t\t\t.action-btn.active:hover {\n\t\t\t\t\tbackground-color: var(--success-green);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);\n\t\t\t\t}\n\t\t\t\t.action-btn.edit-btn {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder-color: var(--warning-orange);\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t}\n\t\t\t\t.action-btn.edit-btn:hover:not(:disabled) {\n\t\t\t\t\tbackground-color: var(--warning-orange);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);\n\t\t\t\t}\n\t\t\t\t.action-btn.edit-btn:disabled {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder-color: var(--disabled-gray);\n\t\t\t\t\tcolor: var(--btn-text-inactive);\n\t\t\t\t\tcursor: not-allowed;\n\t\t\t\t\topacity: 0.5;\n\t\t\t\t}\n\t\t\t\t.action-btn.edit-btn:disabled:hover {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\ttransform: none;\n\t\t\t\t\tbox-shadow: none;\n\t\t\t\t}\n\t\t\t\t.modal-overlay {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\tposition: fixed;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tbackground-color: var(--modal-overlay);\n\t\t\t\t\tz-index: 1000;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t.modal-overlay.active {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t}\n\t\t\t\t.modal-content {\n\t\t\t\t\tbackground: var(--bg-secondary);\n\t\t\t\t\tborder-radius: 8px;\n\t\t\t\t\twidth: 90%;\n\t\t\t\t\tmax-width: 600px;\n\t\t\t\t\tmax-height: 90vh;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tbox-shadow: 0 4px 6px var(--shadow);\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t.modal-header {\n\t\t\t\t\tpadding: 1.5rem;\n\t\t\t\t\tborder-bottom: 1px solid var(--border-color);\n\t\t\t\t}\n\t\t\t\t.modal-header h3 {\n\t\t\t\t\tmargin: 0;\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t}\n\t\t\t\t.modal-body {\n\t\t\t\t\tpadding: 1.5rem;\n\t\t\t\t\tflex: 1;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t}\n\t\t\t\t.modal-footer {\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t\tpadding: 1.5rem;\n\t\t\t\t\tborder-top: 1px solid var(--border-color);\n\t\t\t\t\tjustify-content: flex-end;\n\t\t\t\t}\n\t\t\t\t.form-group {\n\t\t\t\t\tmargin: 1rem 0;\n\t\t\t\t}\n\t\t\t\t.form-group label {\n\t\t\t\t\tdisplay: block;\n\t\t\t\t\tmargin-bottom: 0.5rem;\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t}\n\t\t\t\t.form-group input {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tpadding: 0.5rem;\n\t\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\tfont-size: 1rem;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tbackground-color: var(--bg-tertiary);\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t}\n\t\t\t\t.btn-primary {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t\tpadding: 0.5rem 1rem;\n\t\t\t\t\tborder: 2px solid var(--primary-blue);\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t}\n\t\t\t\t.btn-primary:hover {\n\t\t\t\t\tbackground-color: var(--primary-blue);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\ttransform: translateY(-1px);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);\n\t\t\t\t}\n\t\t\t\t.btn-primary:focus {\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\t.btn-primary:active {\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t\t.file-edit-btn {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder: 2px solid var(--warning-orange);\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t}\n\t\t\t\t.file-edit-btn:hover {\n\t\t\t\t\tbackground-color: var(--warning-orange);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\ttransform: translateY(-1px);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);\n\t\t\t\t}\n\t\t\t\t.file-edit-btn:active {\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t\t.btn-secondary {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t\tpadding: 0.5rem 1rem;\n\t\t\t\t\tborder: 2px solid var(--secondary-gray);\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t}\n\t\t\t\t.btn-secondary:hover {\n\t\t\t\t\tbackground-color: var(--secondary-gray);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\ttransform: translateY(-1px);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);\n\t\t\t\t}\n\t\t\t\t.btn-secondary:focus {\n\t\t\t\t\toutline: 2px solid var(--secondary-gray);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\t.btn-secondary:active {\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t\t.files-table tr.selected {\n\t\t\t\t\tbackground-color: var(--selected-bg);\n\t\t\t\t}\n\t\t\t\t.changed {\n\t\t\t\t\tbackground-color: var(--changed-bg);\n\t\t\t\t}\n\t\t\t\t.checkbox-cell {\n\t\t\t\t\twidth: 30px;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\t\t\t\t.checkbox-cell input[type=\"checkbox\"]:focus {\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\tinput[type=\"checkbox\"] {\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t}\n\t\t\t\t.table-container {\n\t\t\t\t\tmax-height: calc(100vh - 150px);\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\toverflow-x: auto;\n\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t}\n\t\t\t\t.files-table {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tborder-collapse: collapse;\n\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\tfont-size: 0.9rem;\n\t\t\t\t}\n\t\t\t\t.files-table th,\n\t\t\t\t.files-table td {\n\t\t\t\t\tpadding: 0.5rem;\n\t\t\t\t\ttext-align: left;\n\t\t\t\t\tborder-bottom: 1px solid var(--border-color);\n\t\t\t\t}\n\t\t\t\t.files-table th {\n\t\t\t\t\tbackground-color: var(--bg-tertiary);\n\t\t\t\t\tfont-weight: 600;\n\t\t\t\t\tcolor: var(--text-primary);\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tz-index: 10;\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable {\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tuser-select: none;\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tz-index: 10;\n\t\t\t\t\tpadding-right: 1.5rem;\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable:hover {\n\t\t\t\t\tbackground-color: var(--hover-bg);\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable .sort-indicator {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\tright: 0.5rem;\n\t\t\t\t\ttop: 50%;\n\t\t\t\t\ttransform: translateY(-50%);\n\t\t\t\t\tfont-size: 0.8rem;\n\t\t\t\t\tcolor: var(--primary-blue);\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable .sort-indicator::after {\n\t\t\t\t\tcontent: ' ‚Üï';\n\t\t\t\t\topacity: 0.3;\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable.sort-asc .sort-indicator::after {\n\t\t\t\t\tcontent: ' ‚Üë';\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t.files-table th.sortable.sort-desc .sort-indicator::after {\n\t\t\t\t\tcontent: ' ‚Üì';\n\t\t\t\t\topacity: 1;\n\t\t\t\t}\n\t\t\t\t.files-table tr:hover {\n\t\t\t\t\tbackground-color: var(--hover-bg);\n\t\t\t\t}\n\t\t\t\t.files-table td {\n\t\t\t\t\tmax-width: 150px;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\ttext-overflow: ellipsis;\n\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t}\n\t\t\t\t.cover-art {\n\t\t\t\t\twidth: 60px;\n\t\t\t\t\theight: 60px;\n\t\t\t\t\tobject-fit: cover;\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t}\n\t\t\t\t.cover-art-placeholder {\n\t\t\t\t\twidth: 60px;\n\t\t\t\t\theight: 60px;\n\t\t\t\t\tbackground-color: var(--bg-tertiary);\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t\tcolor: var(--text-secondary);\n\t\t\t\t\tfont-size: 0.7rem;\n\t\t\t\t}\n\t\t\t\t.empty-state {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tpadding: 3rem;\n\t\t\t\t\tcolor: var(--text-secondary);\n\t\t\t\t}\n\t\t\t\t.loading {\n\t\t\t\t\ttext-align: center;\n\t\t\t\t\tpadding: 2rem;\n\t\t\t\t\tcolor: var(--text-secondary);\n\t\t\t\t}\n\t\t\t\t.download-spinner {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\twidth: 16px;\n\t\t\t\t\theight: 16px;\n\t\t\t\t\tborder: 2px solid var(--white);\n\t\t\t\t\tborder-top: 2px solid transparent;\n\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\tanimation: spin 0.8s linear infinite;\n\t\t\t\t\tmargin-left: 8px;\n\t\t\t\t\tvertical-align: middle;\n\t\t\t\t}\n\t\t\t\t.download-spinner.active {\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t\t@keyframes spin {\n\t\t\t\t\t0% { transform: rotate(0deg); }\n\t\t\t\t\t100% { transform: rotate(360deg); }\n\t\t\t\t}\n\t\t\t\t.download-btn-wrapper {\n\t\t\t\t\tdisplay: inline-flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t}\n\t\t\t\t.column-selector-wrapper {\n\t\t\t\t\tposition: relative;\n\t\t\t\t\tdisplay: inline-block;\n\t\t\t\t}\n\t\t\t\t.column-selector-btn {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tcolor: var(--btn-text-active);\n\t\t\t\t\tpadding: 0.75rem 1.5rem;\n\t\t\t\t\tborder: 2px solid var(--primary-blue);\n\t\t\t\t\tborder-radius: 12px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-size: 1rem;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t\ttransition: all 0.2s ease;\n\t\t\t\t}\n\t\t\t\t.column-selector-btn:hover {\n\t\t\t\t\tbackground-color: var(--primary-blue);\n\t\t\t\t\tcolor: var(--white);\n\t\t\t\t\ttransform: translateY(-1px);\n\t\t\t\t\tbox-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);\n\t\t\t\t}\n\t\t\t\t.column-selector-btn:focus {\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: 2px;\n\t\t\t\t}\n\t\t\t\t.column-selector-btn:active {\n\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t}\n\t\t\t\t.column-selector-dropdown {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 100%;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tbackground: var(--bg-secondary);\n\t\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\tbox-shadow: 0 2px 8px var(--shadow);\n\t\t\t\t\tmin-width: 180px;\n\t\t\t\t\tz-index: 200;\n\t\t\t\t\tmargin-top: 0.25rem;\n\t\t\t\t\tpadding: 0.5rem 0;\n\t\t\t\t}\n\t\t\t\t.column-selector-dropdown.active {\n\t\t\t\t\tdisplay: block;\n\t\t\t\t}\n\t\t\t\t.column-selector-item {\n\t\t\t\t\tpadding: 0.5rem 1rem;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t}\n\t\t\t\t.column-selector-item:hover {\n\t\t\t\t\tbackground-color: var(--hover-bg);\n\t\t\t\t}\n\t\t\t\t.column-selector-item input[type=\"checkbox\"] {\n\t\t\t\t\tmargin: 0;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\twidth: 18px;\n\t\t\t\t\theight: 18px;\n\t\t\t\t\taccent-color: var(--primary-blue);\n\t\t\t\t}\n\t\t\t\t.column-selector-item label {\n\t\t\t\t\tmargin: 0;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tfont-weight: normal;\n\t\t\t\t}\n\t\t\t\t.column-selector-item:focus-within {\n\t\t\t\t\tbackground-color: var(--selected-bg);\n\t\t\t\t\toutline: 2px solid var(--focus-blue);\n\t\t\t\t\toutline-offset: -2px;\n\t\t\t\t}\n\t\t\t\t.column-hidden {\n\t\t\t\t\tdisplay: none !important;\n\t\t\t\t}\n\t\t\t</style></head><body><button class=\"theme-toggle\" id=\"themeToggle\" aria-label=\"Toggle theme\" tabindex=\"0\">üåô</button><div class=\"container\"><h1>Audio Tag Editor</h1><div class=\"upload-section\"><div class=\"file-input-wrapper\"><input type=\"file\" id=\"fileInput\" class=\"file-input\" multiple accept=\"audio/*\"> <button class=\"upload-btn\" tabindex=\"0\" onclick=\"document.getElementById('fileInput').click()\">Load Files</button></div></div><div class=\"actions-section\" id=\"actionsSection\" style=\"display: none;\"><button class=\"action-btn\" id=\"selectBtn\" tabindex=\"0\" onclick=\"toggleSelectMode()\">Select</button>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = ColumnSelector().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 3, "<button class=\"action-btn edit-btn\" id=\"editBtn\" onclick=\"showEditForm()\" disabled style=\"display: none;\">Edit</button><div class=\"download-btn-wrapper\"><button class=\"action-btn\" id=\"downloadBtn\" onclick=\"downloadSelectedFiles()\" disabled style=\"display: none;\">Download Selected</button> <span class=\"download-spinner\" id=\"downloadSelectedSpinner\"></span></div><div class=\"download-btn-wrapper\"><button class=\"action-btn\" id=\"downloadAllBtn\" tabindex=\"0\" onclick=\"downloadAllFiles()\">Download All</button> <span class=\"download-spinner\" id=\"downloadAllSpinner\"></span></div></div>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = EditModal().Render(ctx, templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 4, "<div id=\"filesContainer\"><div class=\"empty-state\">No files loaded yet. Click \"Load Files\" to select audio files.</div></div></div><script>\n\t\t\t\tfunction initTheme() {\n\t\t\t\t\tconst savedTheme = localStorage.getItem('theme') || 'dark';\n\t\t\t\t\tdocument.documentElement.setAttribute('data-theme', savedTheme);\n\t\t\t\t\tupdateThemeIcon(savedTheme);\n\t\t\t\t}\n\n\t\t\t\tfunction toggleTheme() {\n\t\t\t\t\tconst currentTheme = document.documentElement.getAttribute('data-theme');\n\t\t\t\t\tconst newTheme = currentTheme === 'dark' ? 'light' : 'dark';\n\t\t\t\t\tdocument.documentElement.setAttribute('data-theme', newTheme);\n\t\t\t\t\tlocalStorage.setItem('theme', newTheme);\n\t\t\t\t\tupdateThemeIcon(newTheme);\n\t\t\t\t}\n\n\t\t\t\tfunction updateThemeIcon(theme) {\n\t\t\t\t\tconst themeToggle = document.getElementById('themeToggle');\n\t\t\t\t\tif (themeToggle) {\n\t\t\t\t\t\tthemeToggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tinitTheme();\n\n\t\t\t\tdocument.getElementById('themeToggle').addEventListener('click', toggleTheme);\n\t\t\t\tdocument.getElementById('themeToggle').addEventListener('keydown', function(e) {\n\t\t\t\t\tif (e.key === 'Enter' || e.key === ' ') {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\ttoggleTheme();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet currentFiles = [];\n\t\t\t\tlet sortState = { column: 'track', direction: 'asc' };\n\t\t\t\tlet selectionMode = false;\n\t\t\t\tlet selectedFileIds = new Set();\n\t\t\t\tlet fileIdMap = new Map();\n\t\t\t\tlet columnVisibility = {\n\t\t\t\t\tcover: true,\n\t\t\t\t\ttitle: true,\n\t\t\t\t\tartist: true,\n\t\t\t\t\talbum: true,\n\t\t\t\t\tyear: true,\n\t\t\t\t\tgenre: true,\n\t\t\t\t\ttrack: true,\n\t\t\t\t\tduration: true,\n\t\t\t\t\tformat: true,\n\t\t\t\t\tsize: true\n\t\t\t\t};\n\n\t\t\t\tdocument.getElementById('fileInput').addEventListener('change', async function(e) {\n\t\t\t\t\tconst files = e.target.files;\n\t\t\t\t\tif (files.length === 0) return;\n\n\t\t\t\t\tconst container = document.getElementById('filesContainer');\n\t\t\t\t\tcontainer.innerHTML = '<div class=\"loading\">Loading files...</div>';\n\n\t\t\t\t\tconst formData = new FormData();\n\t\t\t\t\tfor (let i = 0; i < files.length; i++) {\n\t\t\t\t\t\tformData.append('files', files[i]);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst response = await fetch('/api/upload', {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\tbody: formData\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tthrow new Error('Failed to upload files');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst data = await response.json();\n\t\t\t\t\t\tcurrentFiles = data.files;\n\t\t\t\t\t\tfileIdMap.clear();\n\t\t\t\t\t\tcurrentFiles.forEach((file, index) => {\n\t\t\t\t\t\t\tfileIdMap.set(file.id || index, file);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tsortState = { column: 'track', direction: 'asc' };\n\t\t\t\t\t\tselectionMode = false;\n\t\t\t\t\t\tselectedFileIds.clear();\n\t\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t\t\tif (currentFiles.length > 0) {\n\t\t\t\t\t\t\tdocument.getElementById('actionsSection').style.display = 'flex';\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tcontainer.innerHTML = '<div class=\"empty-state\" style=\"color: red;\">Error loading files: ' + error.message + '</div>';\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfunction sortFiles(files, column, direction) {\n\t\t\t\t\tconst sorted = [...files];\n\t\t\t\t\tsorted.sort((a, b) => {\n\t\t\t\t\t\tlet aVal = a[column];\n\t\t\t\t\t\tlet bVal = b[column];\n\n\t\t\t\t\t\tif (aVal === null || aVal === undefined || aVal === '') aVal = '';\n\t\t\t\t\t\tif (bVal === null || bVal === undefined || bVal === '') bVal = '';\n\n\t\t\t\t\t\tif (column === 'year' || column === 'track' || column === 'duration' || column === 'size') {\n\t\t\t\t\t\t\taVal = aVal || 0;\n\t\t\t\t\t\t\tbVal = bVal || 0;\n\t\t\t\t\t\t\treturn direction === 'asc' ? aVal - bVal : bVal - aVal;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\taVal = String(aVal).toLowerCase();\n\t\t\t\t\t\tbVal = String(bVal).toLowerCase();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (direction === 'asc') {\n\t\t\t\t\t\t\treturn aVal.localeCompare(bVal);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn bVal.localeCompare(aVal);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn sorted;\n\t\t\t\t}\n\n\t\t\t\tfunction handleSort(column) {\n\t\t\t\t\tif (sortState.column === column) {\n\t\t\t\t\t\tsortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsortState.column = column;\n\t\t\t\t\t\tsortState.direction = 'asc';\n\t\t\t\t\t}\n\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t}\n\n\t\t\t\tfunction handleTableNavigation(event, elementType, rowIndex) {\n\t\t\t\t\tconst sortedFiles = sortFiles(currentFiles, sortState.column, sortState.direction);\n\t\t\t\t\tconst totalRows = sortedFiles.length;\n\t\t\t\t\t\n\t\t\t\t\tif (elementType === 'checkbox') {\n\t\t\t\t\t\tif (event.key === 'ArrowDown') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tif (rowIndex < totalRows - 1) {\n\t\t\t\t\t\t\t\tconst nextCheckbox = document.querySelector('.file-checkbox[data-row-index=\"' + (rowIndex + 1) + '\"]');\n\t\t\t\t\t\t\t\tif (nextCheckbox) {\n\t\t\t\t\t\t\t\t\tnextCheckbox.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowUp') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tif (rowIndex > 0) {\n\t\t\t\t\t\t\t\tconst prevCheckbox = document.querySelector('.file-checkbox[data-row-index=\"' + (rowIndex - 1) + '\"]');\n\t\t\t\t\t\t\t\tif (prevCheckbox) {\n\t\t\t\t\t\t\t\t\tprevCheckbox.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowRight') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst editBtn = document.querySelector('.file-edit-btn[data-row-index=\"' + rowIndex + '\"]');\n\t\t\t\t\t\t\tif (editBtn) {\n\t\t\t\t\t\t\t\teditBtn.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (elementType === 'edit-btn') {\n\t\t\t\t\t\tif (event.key === 'ArrowDown') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst downloadBtn = document.querySelector('.file-download-btn[data-row-index=\"' + rowIndex + '\"]');\n\t\t\t\t\t\t\tif (downloadBtn) {\n\t\t\t\t\t\t\t\tdownloadBtn.focus();\n\t\t\t\t\t\t\t} else if (rowIndex < totalRows - 1) {\n\t\t\t\t\t\t\t\tconst nextEditBtn = document.querySelector('.file-edit-btn[data-row-index=\"' + (rowIndex + 1) + '\"]');\n\t\t\t\t\t\t\t\tif (nextEditBtn) {\n\t\t\t\t\t\t\t\t\tnextEditBtn.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowUp') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tif (rowIndex > 0) {\n\t\t\t\t\t\t\t\tconst prevDownloadBtn = document.querySelector('.file-download-btn[data-row-index=\"' + (rowIndex - 1) + '\"]');\n\t\t\t\t\t\t\t\tif (prevDownloadBtn) {\n\t\t\t\t\t\t\t\t\tprevDownloadBtn.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst checkbox = document.querySelector('.file-checkbox[data-row-index=\"' + rowIndex + '\"]');\n\t\t\t\t\t\t\tif (checkbox) {\n\t\t\t\t\t\t\t\tcheckbox.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (elementType === 'download-btn') {\n\t\t\t\t\t\tif (event.key === 'ArrowDown') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tif (rowIndex < totalRows - 1) {\n\t\t\t\t\t\t\t\tconst nextEditBtn = document.querySelector('.file-edit-btn[data-row-index=\"' + (rowIndex + 1) + '\"]');\n\t\t\t\t\t\t\t\tif (nextEditBtn) {\n\t\t\t\t\t\t\t\t\tnextEditBtn.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowUp') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst editBtn = document.querySelector('.file-edit-btn[data-row-index=\"' + rowIndex + '\"]');\n\t\t\t\t\t\t\tif (editBtn) {\n\t\t\t\t\t\t\t\teditBtn.focus();\n\t\t\t\t\t\t\t} else if (rowIndex > 0) {\n\t\t\t\t\t\t\t\tconst prevDownloadBtn = document.querySelector('.file-download-btn[data-row-index=\"' + (rowIndex - 1) + '\"]');\n\t\t\t\t\t\t\t\tif (prevDownloadBtn) {\n\t\t\t\t\t\t\t\t\tprevDownloadBtn.focus();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (event.key === 'ArrowLeft') {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tconst checkbox = document.querySelector('.file-checkbox[data-row-index=\"' + rowIndex + '\"]');\n\t\t\t\t\t\t\tif (checkbox) {\n\t\t\t\t\t\t\t\tcheckbox.focus();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction displayFiles(files) {\n\t\t\t\t\tconst container = document.getElementById('filesContainer');\n\t\t\t\t\t\n\t\t\t\t\tif (files.length === 0) {\n\t\t\t\t\t\tcontainer.innerHTML = '<div class=\"empty-state\">No files loaded.</div>';\n\t\t\t\t\t\tdocument.getElementById('actionsSection').style.display = 'none';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst sortedFiles = sortFiles(files, sortState.column, sortState.direction);\n\n\t\t\t\t\tconst getSortClass = (col) => {\n\t\t\t\t\t\tif (sortState.column === col) {\n\t\t\t\t\t\t\treturn sortState.direction === 'asc' ? 'sortable sort-asc' : 'sortable sort-desc';\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn 'sortable';\n\t\t\t\t\t};\n\n\t\t\t\t\tlet html = '<div class=\"table-container\"><table class=\"files-table\"><thead><tr>';\n\t\t\t\t\tif (selectionMode) {\n\t\t\t\t\t\thtml += '<th class=\"checkbox-cell\"><input type=\"checkbox\" id=\"selectAll\" tabindex=\"0\" onchange=\"toggleSelectAll(this.checked)\"></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.cover) {\n\t\t\t\t\t\thtml += '<th data-column=\"cover\">Cover</th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.title) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('title') + '\" data-column=\"title\" onclick=\"handleSort(\\'title\\')\">Title<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.artist) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('artist') + '\" data-column=\"artist\" onclick=\"handleSort(\\'artist\\')\">Artist<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.album) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('album') + '\" data-column=\"album\" onclick=\"handleSort(\\'album\\')\">Album<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.year) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('year') + '\" data-column=\"year\" onclick=\"handleSort(\\'year\\')\">Year<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.genre) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('genre') + '\" data-column=\"genre\" onclick=\"handleSort(\\'genre\\')\">Genre<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.track) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('track') + '\" data-column=\"track\" onclick=\"handleSort(\\'track\\')\">Track<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.duration) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('duration') + '\" data-column=\"duration\" onclick=\"handleSort(\\'duration\\')\">Duration<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.format) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('format') + '\" data-column=\"format\" onclick=\"handleSort(\\'format\\')\">Format<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\tif (columnVisibility.size) {\n\t\t\t\t\t\thtml += '<th class=\"' + getSortClass('size') + '\" data-column=\"size\" onclick=\"handleSort(\\'size\\')\">File Size<span class=\"sort-indicator\"></span></th>';\n\t\t\t\t\t}\n\t\t\t\t\thtml += '<th></th>';\n\t\t\t\t\thtml += '</tr></thead><tbody>';\n\t\t\t\t\t\n\t\t\t\t\tsortedFiles.forEach((file, index) => {\n\t\t\t\t\t\tconst fileId = file.id || index;\n\t\t\t\t\t\tconst isSelected = selectedFileIds.has(fileId);\n\t\t\t\t\t\thtml += '<tr data-file-id=\"' + fileId + '\" data-row-index=\"' + index + '\"' + (isSelected ? ' class=\"selected\"' : '') + '>';\n\t\t\t\t\t\tif (selectionMode) {\n\t\t\t\t\t\t\thtml += '<td class=\"checkbox-cell\"><input type=\"checkbox\" class=\"file-checkbox\" data-file-id=\"' + fileId + '\" data-row-index=\"' + index + '\" data-navigation-type=\"checkbox\" tabindex=\"0\" ' + (isSelected ? ' checked' : '') + ' onchange=\"toggleFileSelection(\\'' + fileId + '\\', this.checked)\" onkeydown=\"handleTableNavigation(event, \\'checkbox\\', ' + index + ')\"></td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.cover) {\n\t\t\t\t\t\t\tif (file.coverArt) {\n\t\t\t\t\t\t\t\thtml += '<td data-column=\"cover\"><img src=\"' + escapeHtml(file.coverArt) + '\" alt=\"Cover\" class=\"cover-art\"></td>';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\thtml += '<td data-column=\"cover\"><div class=\"cover-art-placeholder\">No Cover</div></td>';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst changedFields = file.changedFields || [];\n\t\t\t\t\t\tif (columnVisibility.title) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"title\"' + (changedFields.includes('title') ? ' class=\"changed\"' : '') + '>' + escapeHtml(file.title || 'Unknown') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.artist) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"artist\"' + (changedFields.includes('artist') ? ' class=\"changed\"' : '') + '>' + escapeHtml(file.artist || '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.album) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"album\"' + (changedFields.includes('album') ? ' class=\"changed\"' : '') + '>' + escapeHtml(file.album || '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.year) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"year\"' + (changedFields.includes('year') ? ' class=\"changed\"' : '') + '>' + (file.year !== undefined && file.year !== null ? file.year : '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.genre) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"genre\"' + (changedFields.includes('genre') ? ' class=\"changed\"' : '') + '>' + escapeHtml(file.genre || '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.track) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"track\"' + (changedFields.includes('track') ? ' class=\"changed\"' : '') + '>' + (file.track !== undefined && file.track !== null && file.track !== 0 ? file.track : '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.duration) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"duration\">' + formatDuration(file.duration) + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.format) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"format\">' + escapeHtml(file.format || '-') + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (columnVisibility.size) {\n\t\t\t\t\t\t\thtml += '<td data-column=\"size\">' + formatFileSize(file.size) + '</td>';\n\t\t\t\t\t\t}\n\t\t\t\t\t\thtml += '<td>';\n\t\t\t\t\t\thtml += '<button class=\"btn-primary file-edit-btn\" data-file-id=\"' + fileId + '\" data-row-index=\"' + index + '\" data-navigation-type=\"edit-btn\" tabindex=\"0\" onclick=\"editSingleFile(\\'' + fileId + '\\')\" onkeydown=\"handleTableNavigation(event, \\'edit-btn\\', ' + index + ')\" style=\"padding: 0.25rem 0.5rem; font-size: 0.8rem; margin-bottom: 0.25rem; display: block; width: 100%;\">Edit</button>';\n\t\t\t\t\t\thtml += '<button class=\"btn-primary file-download-btn\" data-file-id=\"' + fileId + '\" data-row-index=\"' + index + '\" data-navigation-type=\"download-btn\" tabindex=\"0\" onclick=\"downloadFile(\\'' + fileId + '\\')\" onkeydown=\"handleTableNavigation(event, \\'download-btn\\', ' + index + ')\" style=\"padding: 0.25rem 0.5rem; font-size: 0.8rem; display: block; width: 100%;\">Download</button>';\n\t\t\t\t\t\thtml += '</td>';\n\t\t\t\t\t\thtml += '</tr>';\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\thtml += '</tbody></table></div>';\n\t\t\t\t\tcontainer.innerHTML = html;\n\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t}\n\n\t\t\t\tfunction toggleSelectMode() {\n\t\t\t\t\tselectionMode = !selectionMode;\n\t\t\t\t\tconst btn = document.getElementById('selectBtn');\n\t\t\t\t\tconst editBtn = document.getElementById('editBtn');\n\t\t\t\t\tconst downloadBtn = document.getElementById('downloadBtn');\n\t\t\t\t\tif (selectionMode) {\n\t\t\t\t\t\tbtn.classList.add('active');\n\t\t\t\t\t\tbtn.textContent = 'Cancel Selection';\n\t\t\t\t\t\teditBtn.style.display = 'inline-block';\n\t\t\t\t\t\tdownloadBtn.style.display = 'inline-block';\n\t\t\t\t\t\teditBtn.setAttribute('tabindex', '0');\n\t\t\t\t\t\tdownloadBtn.setAttribute('tabindex', '0');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbtn.classList.remove('active');\n\t\t\t\t\t\tbtn.textContent = 'Select';\n\t\t\t\t\t\tselectedFileIds.clear();\n\t\t\t\t\t\tdocument.getElementById('modalOverlay').classList.remove('active');\n\t\t\t\t\t\teditBtn.style.display = 'none';\n\t\t\t\t\t\tdownloadBtn.style.display = 'none';\n\t\t\t\t\t}\n\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t}\n\n\t\t\t\tfunction toggleFileSelection(fileId, checked) {\n\t\t\t\t\tif (checked) {\n\t\t\t\t\t\tselectedFileIds.add(fileId);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tselectedFileIds.delete(fileId);\n\t\t\t\t\t}\n\t\t\t\t\tconst row = document.querySelector('tr[data-file-id=\"' + fileId + '\"]');\n\t\t\t\t\tif (row) {\n\t\t\t\t\t\tif (checked) {\n\t\t\t\t\t\t\trow.classList.add('selected');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trow.classList.remove('selected');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t\tupdateSelectAllCheckbox();\n\t\t\t\t}\n\n\t\t\t\tfunction toggleSelectAll(checked) {\n\t\t\t\t\tconst sortedFiles = sortFiles(currentFiles, sortState.column, sortState.direction);\n\t\t\t\t\tsortedFiles.forEach((file, index) => {\n\t\t\t\t\t\tconst fileId = file.id || index;\n\t\t\t\t\t\tif (checked) {\n\t\t\t\t\t\t\tselectedFileIds.add(fileId);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tselectedFileIds.delete(fileId);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst checkbox = document.querySelector('.file-checkbox[data-file-id=\"' + fileId + '\"]');\n\t\t\t\t\t\tif (checkbox) {\n\t\t\t\t\t\t\tcheckbox.checked = checked;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst row = document.querySelector('tr[data-file-id=\"' + fileId + '\"]');\n\t\t\t\t\t\tif (row) {\n\t\t\t\t\t\t\tif (checked) {\n\t\t\t\t\t\t\t\trow.classList.add('selected');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\trow.classList.remove('selected');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t}\n\n\t\t\t\tfunction updateSelectAllCheckbox() {\n\t\t\t\t\tconst selectAllCheckbox = document.getElementById('selectAll');\n\t\t\t\t\tif (selectAllCheckbox) {\n\t\t\t\t\t\tconst sortedFiles = sortFiles(currentFiles, sortState.column, sortState.direction);\n\t\t\t\t\t\tconst allSelected = sortedFiles.every((file, index) => {\n\t\t\t\t\t\t\tconst fileId = file.id || index;\n\t\t\t\t\t\t\treturn selectedFileIds.has(fileId);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tselectAllCheckbox.checked = allSelected && sortedFiles.length > 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction updateEditButtonState() {\n\t\t\t\t\tconst editBtn = document.getElementById('editBtn');\n\t\t\t\t\tconst downloadBtn = document.getElementById('downloadBtn');\n\t\t\t\t\tconst hasSelection = selectedFileIds.size > 0;\n\t\t\t\t\teditBtn.disabled = !hasSelection;\n\t\t\t\t\tdownloadBtn.disabled = !hasSelection;\n\t\t\t\t\tif (!editBtn.disabled) {\n\t\t\t\t\t\teditBtn.setAttribute('tabindex', '0');\n\t\t\t\t\t} else {\n\t\t\t\t\t\teditBtn.removeAttribute('tabindex');\n\t\t\t\t\t}\n\t\t\t\t\tif (!downloadBtn.disabled) {\n\t\t\t\t\t\tdownloadBtn.setAttribute('tabindex', '0');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdownloadBtn.removeAttribute('tabindex');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction editSingleFile(fileId) {\n\t\t\t\t\tselectedFileIds.clear();\n\t\t\t\t\tselectedFileIds.add(fileId);\n\t\t\t\t\tif (!selectionMode) {\n\t\t\t\t\t\tselectionMode = true;\n\t\t\t\t\t\tconst btn = document.getElementById('selectBtn');\n\t\t\t\t\t\tbtn.classList.add('active');\n\t\t\t\t\t\tbtn.textContent = 'Cancel Selection';\n\t\t\t\t\t\tconst editBtn = document.getElementById('editBtn');\n\t\t\t\t\t\tconst downloadBtn = document.getElementById('downloadBtn');\n\t\t\t\t\t\teditBtn.style.display = 'inline-block';\n\t\t\t\t\t\tdownloadBtn.style.display = 'inline-block';\n\t\t\t\t\t}\n\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t\tshowEditForm();\n\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t}\n\n\t\t\t\tlet currentCoverArt = null;\n\t\t\t\tlet coverArtChanged = false;\n\t\t\t\tlet originalFormValues = {\n\t\t\t\t\tartist: null,\n\t\t\t\t\talbum: null,\n\t\t\t\t\tyear: null,\n\t\t\t\t\tgenre: null,\n\t\t\t\t\ttitle: null,\n\t\t\t\t\ttrack: null\n\t\t\t\t};\n\n\t\t\t\tdocument.getElementById('editCoverArt').addEventListener('change', function(e) {\n\t\t\t\t\tconst file = e.target.files[0];\n\t\t\t\t\tif (!file) {\n\t\t\t\t\t\tcurrentCoverArt = null;\n\t\t\t\t\t\tcoverArtChanged = false;\n\t\t\t\t\t\tdocument.getElementById('coverPreview').innerHTML = '';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!file.type.startsWith('image/')) {\n\t\t\t\t\t\talert('Please select an image file');\n\t\t\t\t\t\te.target.value = '';\n\t\t\t\t\t\tcurrentCoverArt = null;\n\t\t\t\t\t\tcoverArtChanged = false;\n\t\t\t\t\t\tdocument.getElementById('coverPreview').innerHTML = '';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst reader = new FileReader();\n\t\t\t\t\treader.onload = function(event) {\n\t\t\t\t\t\tcurrentCoverArt = event.target.result;\n\t\t\t\t\t\tcoverArtChanged = true;\n\t\t\t\t\t\tconst preview = document.getElementById('coverPreview');\n\t\t\t\t\t\tpreview.innerHTML = '<img src=\"' + currentCoverArt + '\" style=\"max-width: 200px; max-height: 200px; border-radius: 4px; margin-top: 0.5rem;\">';\n\t\t\t\t\t};\n\t\t\t\t\treader.onerror = function() {\n\t\t\t\t\t\talert('Failed to read cover art file');\n\t\t\t\t\t\te.target.value = '';\n\t\t\t\t\t\tcurrentCoverArt = null;\n\t\t\t\t\t\tcoverArtChanged = false;\n\t\t\t\t\t\tdocument.getElementById('coverPreview').innerHTML = '';\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t});\n\n\t\t\t\tfunction showEditForm() {\n\t\t\t\t\tif (selectedFileIds.size === 0) return;\n\t\t\t\t\t\n\t\t\t\t\tconst selectedFiles = Array.from(selectedFileIds).map(id => fileIdMap.get(id)).filter(f => f);\n\t\t\t\t\tconst isMultiple = selectedFiles.length > 1;\n\t\t\t\t\t\n\t\t\t\t\tconst commonTitle = getCommonValue(selectedFiles, 'title');\n\t\t\t\t\tconst commonArtist = getCommonValue(selectedFiles, 'artist');\n\t\t\t\t\tconst commonAlbum = getCommonValue(selectedFiles, 'album');\n\t\t\t\t\tconst commonYear = getCommonValue(selectedFiles, 'year');\n\t\t\t\t\tconst commonTrack = getCommonValue(selectedFiles, 'track');\n\t\t\t\t\tconst commonGenre = getCommonValue(selectedFiles, 'genre');\n\t\t\t\t\tconst commonCoverArt = getCommonValue(selectedFiles, 'coverArt');\n\t\t\t\t\t\n\t\t\t\t\tdocument.getElementById('editTitle').value = commonTitle || '';\n\t\t\t\t\tdocument.getElementById('editArtist').value = commonArtist || '';\n\t\t\t\t\tdocument.getElementById('editAlbum').value = commonAlbum || '';\n\t\t\t\t\tdocument.getElementById('editYear').value = (commonYear !== undefined && commonYear !== null) ? commonYear : '';\n\t\t\t\t\tdocument.getElementById('editTrack').value = (commonTrack !== undefined && commonTrack !== null && commonTrack !== 0) ? commonTrack : '';\n\t\t\t\t\tdocument.getElementById('editGenre').value = commonGenre || '';\n\t\t\t\t\t\n\t\t\t\t\toriginalFormValues = {\n\t\t\t\t\t\tartist: commonArtist || '',\n\t\t\t\t\t\talbum: commonAlbum || '',\n\t\t\t\t\t\tyear: (commonYear !== undefined && commonYear !== null) ? commonYear.toString() : '',\n\t\t\t\t\t\tgenre: commonGenre || '',\n\t\t\t\t\t\ttitle: commonTitle || '',\n\t\t\t\t\t\ttrack: (commonTrack !== undefined && commonTrack !== null && commonTrack !== 0) ? commonTrack.toString() : ''\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tdocument.getElementById('editTitle').disabled = isMultiple;\n\t\t\t\t\tdocument.getElementById('editTrack').disabled = isMultiple;\n\t\t\t\t\t\n\t\t\t\t\tcurrentCoverArt = null;\n\t\t\t\t\tcoverArtChanged = false;\n\t\t\t\t\tdocument.getElementById('editCoverArt').value = '';\n\t\t\t\t\tconst preview = document.getElementById('coverPreview');\n\t\t\t\t\tif (commonCoverArt) {\n\t\t\t\t\t\tcurrentCoverArt = commonCoverArt;\n\t\t\t\t\t\tpreview.innerHTML = '<img src=\"' + escapeHtml(commonCoverArt) + '\" style=\"max-width: 200px; max-height: 200px; border-radius: 4px; margin-top: 0.5rem;\">';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpreview.innerHTML = '';\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tdocument.getElementById('modalOverlay').classList.add('active');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tfunction closeModalOnOverlay(event) {\n\t\t\t\t\tif (event.target.id === 'modalOverlay') {\n\t\t\t\t\t\tcancelEdit();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction getCommonValue(files, field) {\n\t\t\t\t\tif (files.length === 0) return '';\n\t\t\t\t\tconst firstValue = files[0][field];\n\t\t\t\t\tif (firstValue === undefined || firstValue === null) return '';\n\t\t\t\t\tif (files.every(f => {\n\t\t\t\t\t\tconst val = f[field];\n\t\t\t\t\t\tif (val === undefined || val === null) return firstValue === '';\n\t\t\t\t\t\treturn val === firstValue;\n\t\t\t\t\t})) {\n\t\t\t\t\t\treturn firstValue;\n\t\t\t\t\t}\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tfunction cancelEdit() {\n\t\t\t\t\tdocument.getElementById('modalOverlay').classList.remove('active');\n\t\t\t\t\tdocument.getElementById('editTitle').value = '';\n\t\t\t\t\tdocument.getElementById('editArtist').value = '';\n\t\t\t\t\tdocument.getElementById('editAlbum').value = '';\n\t\t\t\t\tdocument.getElementById('editYear').value = '';\n\t\t\t\t\tdocument.getElementById('editTrack').value = '';\n\t\t\t\t\tdocument.getElementById('editGenre').value = '';\n\t\t\t\t\tdocument.getElementById('editTitle').disabled = false;\n\t\t\t\t\tdocument.getElementById('editTrack').disabled = false;\n\t\t\t\t\tdocument.getElementById('editCoverArt').value = '';\n\t\t\t\t\tdocument.getElementById('coverPreview').innerHTML = '';\n\t\t\t\t\tcurrentCoverArt = null;\n\t\t\t\t\tcoverArtChanged = false;\n\t\t\t\t\toriginalFormValues = {\n\t\t\t\t\t\tartist: null,\n\t\t\t\t\t\talbum: null,\n\t\t\t\t\t\tyear: null,\n\t\t\t\t\t\tgenre: null,\n\t\t\t\t\t\ttitle: null,\n\t\t\t\t\t\ttrack: null\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tdocument.addEventListener('keydown', function(e) {\n\t\t\t\t\tconst modalOverlay = document.getElementById('modalOverlay');\n\t\t\t\t\tconst isModalActive = modalOverlay.classList.contains('active');\n\t\t\t\t\t\n\t\t\t\t\tif (e.key === 'Escape') {\n\t\t\t\t\t\tif (isModalActive) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tcancelEdit();\n\t\t\t\t\t\t} else if (selectionMode) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\ttoggleSelectMode();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (isModalActive && e.key === 'Enter' && !e.shiftKey && !e.ctrlKey && !e.metaKey) {\n\t\t\t\t\t\tconst activeElement = document.activeElement;\n\t\t\t\t\t\tif (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {\n\t\t\t\t\t\t\tconst inputType = activeElement.type;\n\t\t\t\t\t\t\tif (inputType === 'file' || activeElement.tagName === 'TEXTAREA') {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tsaveTags();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tasync function saveTags() {\n\t\t\t\t\tif (selectedFileIds.size === 0) return;\n\t\t\t\t\t\n\t\t\t\t\tconst selectedFiles = Array.from(selectedFileIds).map(id => fileIdMap.get(id)).filter(f => f);\n\t\t\t\t\tif (selectedFiles.length === 0) {\n\t\t\t\t\t\talert('Selected files are no longer available. Please reload the files.');\n\t\t\t\t\t\tselectedFileIds.clear();\n\t\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst isMultiple = selectedFiles.length > 1;\n\t\t\t\t\t\n\t\t\t\t\tconst artist = document.getElementById('editArtist').value.trim();\n\t\t\t\t\tconst album = document.getElementById('editAlbum').value.trim();\n\t\t\t\t\tconst yearStr = document.getElementById('editYear').value.trim();\n\t\t\t\t\tconst genre = document.getElementById('editGenre').value.trim();\n\t\t\t\t\t\n\t\t\t\t\tconst updates = {\n\t\t\t\t\t\tfileIds: Array.from(selectedFileIds)\n\t\t\t\t\t};\n\t\t\t\t\t\n\t\t\t\t\tconst fieldsToUpdate = new Set();\n\t\t\t\t\t\n\t\t\t\t\tif (artist !== originalFormValues.artist) {\n\t\t\t\t\t\tupdates.artist = artist === '' ? null : artist;\n\t\t\t\t\t\tfieldsToUpdate.add('artist');\n\t\t\t\t\t}\n\t\t\t\t\tif (album !== originalFormValues.album) {\n\t\t\t\t\t\tupdates.album = album === '' ? null : album;\n\t\t\t\t\t\tfieldsToUpdate.add('album');\n\t\t\t\t\t}\n\t\t\t\t\tif (genre !== originalFormValues.genre) {\n\t\t\t\t\t\tupdates.genre = genre === '' ? null : genre;\n\t\t\t\t\t\tfieldsToUpdate.add('genre');\n\t\t\t\t\t}\n\t\t\t\t\tif (yearStr !== originalFormValues.year) {\n\t\t\t\t\t\tconst yearNum = parseInt(yearStr, 10);\n\t\t\t\t\t\tif (!isNaN(yearNum) && yearNum > 0) {\n\t\t\t\t\t\t\tupdates.year = yearNum;\n\t\t\t\t\t\t\tfieldsToUpdate.add('year');\n\t\t\t\t\t\t} else if (yearStr === '' && originalFormValues.year !== '') {\n\t\t\t\t\t\t\tupdates.year = null;\n\t\t\t\t\t\t\tfieldsToUpdate.add('year');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (coverArtChanged && currentCoverArt !== null) {\n\t\t\t\t\t\tupdates.coverArt = currentCoverArt;\n\t\t\t\t\t\tfieldsToUpdate.add('coverArt');\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tif (!isMultiple) {\n\t\t\t\t\t\tconst title = document.getElementById('editTitle').value.trim();\n\t\t\t\t\t\tconst trackStr = document.getElementById('editTrack').value.trim();\n\t\t\t\t\t\tif (title !== originalFormValues.title) {\n\t\t\t\t\t\t\tupdates.title = title === '' ? null : title;\n\t\t\t\t\t\t\tfieldsToUpdate.add('title');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (trackStr !== originalFormValues.track) {\n\t\t\t\t\t\t\tif (trackStr !== '') {\n\t\t\t\t\t\t\t\tconst trackNum = parseInt(trackStr, 10);\n\t\t\t\t\t\t\t\tif (!isNaN(trackNum) && trackNum > 0) {\n\t\t\t\t\t\t\t\t\tupdates.track = trackNum;\n\t\t\t\t\t\t\t\t\tfieldsToUpdate.add('track');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (originalFormValues.track !== '') {\n\t\t\t\t\t\t\t\tupdates.track = null;\n\t\t\t\t\t\t\t\tfieldsToUpdate.add('track');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('Update payload:', JSON.stringify(updates));\n\t\t\t\t\tconsole.log('Is multiple:', isMultiple, 'Has track:', 'track' in updates, 'Has title:', 'title' in updates);\n\t\t\t\t\tconsole.log('Fields to update:', Array.from(fieldsToUpdate));\n\t\t\t\t\t\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconsole.log('Sending update request:', updates);\n\t\t\t\t\t\tconst response = await fetch('/api/update-tags', {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify(updates)\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tconsole.log('Response status:', response.status, response.statusText);\n\t\t\t\t\t\tconsole.log('Response headers:', Object.fromEntries(response.headers.entries()));\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\tconsole.error('Error response:', errorText);\n\t\t\t\t\t\t\tthrow new Error('Failed to update tags: ' + errorText);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst responseText = await response.text();\n\t\t\t\t\t\tconsole.log('Response body:', responseText);\n\t\t\t\t\t\t\n\t\t\t\t\t\tlet data;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tdata = JSON.parse(responseText);\n\t\t\t\t\t\t\tconsole.log('Parsed data:', data);\n\t\t\t\t\t\t} catch (parseError) {\n\t\t\t\t\t\t\tconsole.error('Failed to parse JSON:', parseError, 'Response text:', responseText);\n\t\t\t\t\t\t\tthrow new Error('Invalid JSON response from server: ' + responseText.substring(0, 100));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!data) {\n\t\t\t\t\t\t\tconsole.error('Invalid response structure:', data);\n\t\t\t\t\t\t\tthrow new Error('Invalid response from server: ' + JSON.stringify(data));\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (data.errors && data.errors.length > 0) {\n\t\t\t\t\t\t\tconst errorMsg = data.errors.join('\\n');\n\t\t\t\t\t\t\talert('Error updating files:\\n' + errorMsg);\n\t\t\t\t\t\t\tif (!data.files || data.files.length === 0) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!data.files || data.files.length === 0) {\n\t\t\t\t\t\t\talert('No files were updated. The files may have expired or been removed. Please reload the files.');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tdata.files.forEach(updatedFile => {\n\t\t\t\t\t\t\tconsole.log('Processing updated file:', updatedFile);\n\t\t\t\t\t\t\tconst index = currentFiles.findIndex(f => f.id === updatedFile.id);\n\t\t\t\t\t\t\tconsole.log('Found index:', index, 'for file ID:', updatedFile.id);\n\t\t\t\t\t\t\tif (index !== -1) {\n\t\t\t\t\t\t\t\tconsole.log('Before update - Title:', currentFiles[index].title, 'Artist:', currentFiles[index].artist, 'Album:', currentFiles[index].album, 'Year:', currentFiles[index].year, 'Track:', currentFiles[index].track, 'Genre:', currentFiles[index].genre);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields) {\n\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields = [];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tif (!isMultiple && 'title' in updatedFile) {\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].title !== (updatedFile.title || '')) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].title = updatedFile.title || '';\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('title')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('title');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('artist' in updatedFile) {\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].artist !== (updatedFile.artist || '')) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].artist = updatedFile.artist || '';\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('artist')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('artist');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('album' in updatedFile) {\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].album !== (updatedFile.album || '')) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].album = updatedFile.album || '';\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('album')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('album');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (fieldsToUpdate.has('year') && 'year' in updatedFile) {\n\t\t\t\t\t\t\t\t\tconst newYear = updatedFile.year !== undefined && updatedFile.year !== null ? updatedFile.year : 0;\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].year !== newYear) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].year = newYear;\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('year')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('year');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif (!isMultiple && 'track' in updatedFile) {\n\t\t\t\t\t\t\t\t\tconst newTrack = updatedFile.track !== undefined && updatedFile.track !== null ? updatedFile.track : 0;\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].track !== newTrack) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].track = newTrack;\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('track')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('track');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('genre' in updatedFile) {\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].genre !== (updatedFile.genre || '')) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].genre = updatedFile.genre || '';\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('genre')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('genre');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif ('coverArt' in updatedFile) {\n\t\t\t\t\t\t\t\t\tif (currentFiles[index].coverArt !== (updatedFile.coverArt || '')) {\n\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].coverArt = updatedFile.coverArt || '';\n\t\t\t\t\t\t\t\t\t\tif (!currentFiles[index].changedFields.includes('coverArt')) {\n\t\t\t\t\t\t\t\t\t\t\tcurrentFiles[index].changedFields.push('coverArt');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tconsole.log('After update - Title:', currentFiles[index].title, 'Artist:', currentFiles[index].artist, 'Album:', currentFiles[index].album, 'Year:', currentFiles[index].year, 'Track:', currentFiles[index].track, 'Genre:', currentFiles[index].genre);\n\t\t\t\t\t\t\t\tfileIdMap.set(updatedFile.id, currentFiles[index]);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.error('File not found in currentFiles. Updated file ID:', updatedFile.id);\n\t\t\t\t\t\t\t\tconsole.log('Current file IDs:', currentFiles.map(f => f.id));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tcancelEdit();\n\t\t\t\t\t\tselectedFileIds.clear();\n\t\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\talert('Error updating tags: ' + error.message);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction formatDuration(seconds) {\n\t\t\t\t\tif (!seconds) return 'Unknown';\n\t\t\t\t\tconst mins = Math.floor(seconds / 60);\n\t\t\t\t\tconst secs = Math.floor(seconds % 60);\n\t\t\t\t\treturn mins + ':' + (secs < 10 ? '0' : '') + secs;\n\t\t\t\t}\n\n\t\t\t\tfunction formatFileSize(bytes) {\n\t\t\t\t\tif (!bytes) return 'Unknown';\n\t\t\t\t\tif (bytes < 1024) return bytes + ' B';\n\t\t\t\t\tif (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';\n\t\t\t\t\treturn (bytes / (1024 * 1024)).toFixed(2) + ' MB';\n\t\t\t\t}\n\n\t\t\t\tfunction escapeHtml(text) {\n\t\t\t\t\tconst div = document.createElement('div');\n\t\t\t\t\tdiv.textContent = text;\n\t\t\t\t\treturn div.innerHTML;\n\t\t\t\t}\n\n\t\t\t\tfunction downloadFile(fileId) {\n\t\t\t\t\twindow.open('/api/download/' + fileId, '_blank');\n\t\t\t\t}\n\n\t\t\t\tasync function downloadSelectedFiles() {\n\t\t\t\t\tif (selectedFileIds.size === 0) return;\n\t\t\t\t\t\n\t\t\t\t\tconst fileIds = Array.from(selectedFileIds);\n\t\t\t\t\tconst spinner = document.getElementById('downloadSelectedSpinner');\n\t\t\t\t\tconst downloadBtn = document.getElementById('downloadBtn');\n\t\t\t\t\t\n\t\t\t\t\tspinner.classList.add('active');\n\t\t\t\t\tdownloadBtn.disabled = true;\n\t\t\t\t\t\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst response = await fetch('/api/download-selected', {\n\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Type': 'application/json'\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tbody: JSON.stringify({ fileIds: fileIds })\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\tthrow new Error('Failed to download selected files: ' + errorText);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst contentDisposition = response.headers.get('Content-Disposition');\n\t\t\t\t\t\tlet filename = 'all-tracks.zip';\n\t\t\t\t\t\tif (contentDisposition) {\n\t\t\t\t\t\t\tconst filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n\t\t\t\t\t\t\tif (filenameMatch && filenameMatch[1]) {\n\t\t\t\t\t\t\t\tfilename = filenameMatch[1].replace(/['\"]/g, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst blob = await response.blob();\n\t\t\t\t\t\tif (blob.size === 0) {\n\t\t\t\t\t\t\tthrow new Error('Downloaded file is empty');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst url = window.URL.createObjectURL(blob);\n\t\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\t\ta.href = url;\n\t\t\t\t\t\ta.download = filename;\n\t\t\t\t\t\tdocument.body.appendChild(a);\n\t\t\t\t\t\ta.click();\n\t\t\t\t\t\tdocument.body.removeChild(a);\n\t\t\t\t\t\twindow.URL.revokeObjectURL(url);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error downloading selected files:', error);\n\t\t\t\t\t\talert('Failed to download selected files: ' + error.message);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tspinner.classList.remove('active');\n\t\t\t\t\t\tupdateEditButtonState();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tasync function downloadAllFiles() {\n\t\t\t\t\tconst spinner = document.getElementById('downloadAllSpinner');\n\t\t\t\t\tconst downloadBtn = document.getElementById('downloadAllBtn');\n\t\t\t\t\t\n\t\t\t\t\tspinner.classList.add('active');\n\t\t\t\t\tdownloadBtn.disabled = true;\n\t\t\t\t\t\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst response = await fetch('/api/download-all', {\n\t\t\t\t\t\t\tmethod: 'GET'\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (!response.ok) {\n\t\t\t\t\t\t\tconst errorText = await response.text();\n\t\t\t\t\t\t\tthrow new Error('Failed to download all files: ' + errorText);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst contentDisposition = response.headers.get('Content-Disposition');\n\t\t\t\t\t\tlet filename = 'all-tracks.zip';\n\t\t\t\t\t\tif (contentDisposition) {\n\t\t\t\t\t\t\tconst filenameMatch = contentDisposition.match(/filename[^;=\\n]*=((['\"]).*?\\2|[^;\\n]*)/);\n\t\t\t\t\t\t\tif (filenameMatch && filenameMatch[1]) {\n\t\t\t\t\t\t\t\tfilename = filenameMatch[1].replace(/['\"]/g, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst blob = await response.blob();\n\t\t\t\t\t\tif (blob.size === 0) {\n\t\t\t\t\t\t\tthrow new Error('Downloaded file is empty');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst url = window.URL.createObjectURL(blob);\n\t\t\t\t\t\tconst a = document.createElement('a');\n\t\t\t\t\t\ta.href = url;\n\t\t\t\t\t\ta.download = filename;\n\t\t\t\t\t\tdocument.body.appendChild(a);\n\t\t\t\t\t\ta.click();\n\t\t\t\t\t\tdocument.body.removeChild(a);\n\t\t\t\t\t\twindow.URL.revokeObjectURL(url);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tconsole.error('Error downloading all files:', error);\n\t\t\t\t\t\talert('Failed to download all files: ' + error.message);\n\t\t\t\t\t} finally {\n\t\t\t\t\t\tspinner.classList.remove('active');\n\t\t\t\t\t\tdownloadBtn.disabled = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction toggleColumnSelector() {\n\t\t\t\t\tconst dropdown = document.getElementById('columnSelectorDropdown');\n\t\t\t\t\tconst isActive = dropdown.classList.contains('active');\n\t\t\t\t\tif (isActive) {\n\t\t\t\t\t\tdropdown.classList.remove('active');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdropdown.classList.add('active');\n\t\t\t\t\t\tconst firstItem = dropdown.querySelector('.column-selector-item[data-item-index=\"0\"]');\n\t\t\t\t\t\tif (firstItem) {\n\t\t\t\t\t\t\tsetTimeout(() => firstItem.focus(), 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction toggleColumnVisibility(column, visible) {\n\t\t\t\t\tcolumnVisibility[column] = visible;\n\t\t\t\t\tdisplayFiles(currentFiles);\n\t\t\t\t}\n\n\t\t\t\tfunction handleColumnSelectorNavigation(event, currentIndex) {\n\t\t\t\t\tconst dropdown = document.getElementById('columnSelectorDropdown');\n\t\t\t\t\tif (!dropdown) return;\n\n\t\t\t\t\tconst items = dropdown.querySelectorAll('.column-selector-item');\n\t\t\t\t\tconst totalItems = items.length;\n\n\t\t\t\t\tif (event.key === 'ArrowDown') {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tconst nextIndex = (currentIndex + 1) % totalItems;\n\t\t\t\t\t\tconst nextItem = dropdown.querySelector('.column-selector-item[data-item-index=\"' + nextIndex + '\"]');\n\t\t\t\t\t\tif (nextItem) {\n\t\t\t\t\t\t\tnextItem.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (event.key === 'ArrowUp') {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tconst prevIndex = (currentIndex - 1 + totalItems) % totalItems;\n\t\t\t\t\t\tconst prevItem = dropdown.querySelector('.column-selector-item[data-item-index=\"' + prevIndex + '\"]');\n\t\t\t\t\t\tif (prevItem) {\n\t\t\t\t\t\t\tprevItem.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (event.key === 'Enter' || event.key === ' ') {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tconst checkbox = event.currentTarget.querySelector('input[type=\"checkbox\"]');\n\t\t\t\t\t\tif (checkbox) {\n\t\t\t\t\t\t\tcheckbox.checked = !checkbox.checked;\n\t\t\t\t\t\t\tconst column = checkbox.getAttribute('data-column');\n\t\t\t\t\t\t\ttoggleColumnVisibility(column, checkbox.checked);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (event.key === 'Escape') {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tdropdown.classList.remove('active');\n\t\t\t\t\t\tconst btn = document.getElementById('columnSelectorBtn');\n\t\t\t\t\t\tif (btn) {\n\t\t\t\t\t\t\tbtn.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdocument.getElementById('columnSelectorBtn').addEventListener('keydown', function(event) {\n\t\t\t\t\tif (event.key === 'Enter' || event.key === ' ') {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\ttoggleColumnSelector();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tdocument.addEventListener('click', function(event) {\n\t\t\t\t\tconst dropdown = document.getElementById('columnSelectorDropdown');\n\t\t\t\t\tconst btn = document.getElementById('columnSelectorBtn');\n\t\t\t\t\tif (dropdown && btn && !dropdown.contains(event.target) && !btn.contains(event.target)) {\n\t\t\t\t\t\tdropdown.classList.remove('active');\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t</script></body></html>")
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
